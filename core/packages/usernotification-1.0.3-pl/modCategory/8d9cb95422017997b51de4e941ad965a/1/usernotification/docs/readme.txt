--------------------
User Notification
--------------------
Автор: -=crow=- <gavoronok30@gmail.com>
--------------------

Компонент для отправки оповещений пользователям на сайте

--------------------

Для добавления автоматических оповещений необходимо использовать API компонента в своих сниппетах, плагинах, классах

$modx->getService('usernotification', 'usernotification', MODX_CORE_PATH . 'components/usernotification/model/usernotification/'); // инициализация компонента
// далее можно использовать любой из методов ниже, все параметры обязательны
$modx->usernotification->sendAll('Текст сообщения', 'Заголовок'); // отправить сообщение всем
$modx->usernotification->sendGroup('Текст сообщения', $group_id, 'Заголовок'); // отправить сообщение указанной группе (только ID группы)
$modx->usernotification->sendUser('Текст сообщения', $user_id, 'Заголовок'); // отправить сообщение выбранному пользователю


Для отображения оповещений пользователям, необходимо вызвать сниппет “[[!userNotification]]” в нужном месте шаблона. Сниппет принимает следующие параметры (все опциональные):
<ul>
<li>user_id - ID пользователя</li>
<li>tpl - шаблон каждого отдельного оповещения</li>
<li>tplOuter - шаблон обертка, плейсхолдеры: [[+rows]] - список оповещений, [[+total]] - кол-во оповещений</li>
<li>tplEmpty - чанк оформления контейнера оповещений при отсутствии самих оповещений</li>
<li>mode - если выставлено "count" вернет только кол-во оповещений</li>
<li>where - доп. условия выборки, понимает как массив так и json</li>
<li>sortby, sortdir - поле для сортировки и направление</li>
<li>limit - лимит вывода, по умолчанию отсутствует</li>
<li>js - можно переопределить js по умолчанию</li>
<li>css - можно переопределить css по умолчанию</li>
<li>action - action файл, на который ссылается AJAX</li>
</ul>

Оповещение считается прочтенным, только после нажатия на крестик.
При смене разметки стандартного вывода оповещений, классы с префиксом "js_" должны быть сохранены:
<ul>
    <li>js_usernotification_btn - кнопка по нажатию на которую, появляется окно со списком сообщений</li>
    <li>js_usernotification_total - кол-во сообщений</li>
    <li>js_usernotification_rows - список оповещений</li>
    <li>js_usernotification_row - каждое отдельное оповещение</li>
    <li>js_usernotification_remove- кнопка для удаления оповещения (пометить как прочитанное)</li>
</ul>

Существует события для плагина "UserNotificationCreate" при создании нового сообщения, в нем находится xPDO обьект созданного оповещения, доступный через переменную "$notification"